# Implementation Plan: AR Server Log Analysis Platform MVP

**Branch**: `remedyiq-mvp` | **Date**: 2026-02-09 | **Spec**: [specs/remedyiq-mvp/spec.md](spec.md)
**Input**: Feature specification from `/specs/remedyiq-mvp/spec.md`

## Summary

Build RemedyIQ, a cloud SaaS platform that wraps BMC's ARLogAnalyzer.jar with a modern Go API backend, Next.js frontend, ClickHouse log storage, and Claude AI integration. The MVP delivers file upload, JAR-based analysis, interactive dashboard, log search/exploration, and AI-powered Q&A — all with multi-tenant isolation from day one.

## Technical Context

**Language/Version**: Go 1.22+ (backend), TypeScript 5.x (frontend)
**Primary Dependencies**: gorilla/mux, clickhouse-go v2, pgx v5, bleve v2, nats.go, anthropic-sdk-go (backend); Next.js 14, React 18, shadcn/ui, Recharts, react-window (frontend)
**Storage**: ClickHouse (log entries), PostgreSQL 16+ (metadata, auth, jobs), S3-compatible (uploaded files), Redis 7+ (cache)
**Testing**: Go stdlib `testing` + testify (backend), Vitest + React Testing Library (frontend)
**Target Platform**: Linux server (Docker/Kubernetes), macOS for local development
**Project Type**: Web application (Go API + Next.js frontend)
**Performance Goals**: 500MB log analyzed in <5min, search <2s over 10M entries, dashboard load <3s, live tail latency <500ms
**Constraints**: 2GB max upload, multi-tenant isolation mandatory, SaaS-friendly licenses only
**Scale/Scope**: 50 concurrent users per tenant, 100M log entries per tenant, 3 deployable services max

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Wrapper-First | PASS | JAR subprocess is primary parser; native parsers supplement only |
| II. API-First | PASS | All features exposed via REST/WebSocket before UI; OpenAPI contracts in `contracts/` |
| III. Test-First | PASS | `testdata/` with sample logs; contract tests against OpenAPI; integration tests against real samples |
| IV. AI as a Skill | PASS | Skill registry pattern with typed contracts; 6 skills defined with fallback behavior |
| V. Multi-Tenant | PASS | Tenant isolation at ClickHouse (partition), PostgreSQL (RLS), NATS (subject), Redis (prefix), S3 (path) |
| VI. Simplicity Gate | PASS | 3 services: API Server, Worker, Frontend |
| VII. Log Format Fidelity | PASS | Fidelity test suite compares JAR vs native parser output |
| VIII. Streaming-Ready | PASS | WebSocket live tail, NATS JetStream, batch+stream ingestion |
| IX. Incremental Delivery | PASS | Phase 1=Upload+Dashboard, Phase 2=Search, Phase 3=AI, Phase 4=Advanced |

## Project Structure

### Documentation (this feature)

```text
specs/remedyiq-mvp/
├── plan.md              # This file
├── research.md          # Technology decisions and research
├── data-model.md        # ClickHouse + PostgreSQL schemas
├── quickstart.md        # How to run locally
├── contracts/           # API endpoint specifications
│   ├── openapi.yaml     # REST API (OpenAPI 3.1)
│   └── websocket.md     # WebSocket protocol specification
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
backend/
├── cmd/
│   ├── api/
│   │   └── main.go              # API server entrypoint
│   └── worker/
│       └── main.go              # Worker entrypoint
├── internal/
│   ├── api/
│   │   ├── router.go            # Route definitions
│   │   ├── middleware/
│   │   │   ├── auth.go          # Clerk JWT validation
│   │   │   ├── tenant.go        # Tenant context injection
│   │   │   └── cors.go          # CORS configuration
│   │   └── handlers/
│   │       ├── upload.go        # File upload endpoints
│   │       ├── analysis.go      # Analysis job endpoints
│   │       ├── dashboard.go     # Dashboard data endpoints
│   │       ├── search.go        # Log search endpoints
│   │       ├── stream.go        # WebSocket live tail
│   │       ├── ai.go            # AI skill endpoints
│   │       └── health.go        # Health check
│   ├── domain/
│   │   ├── models.go            # Core domain types
│   │   ├── log_entry.go         # LogEntry type + fields
│   │   └── analysis_job.go      # AnalysisJob lifecycle
│   ├── jar/
│   │   ├── runner.go            # JAR subprocess manager
│   │   ├── parser.go            # JAR output parser (text → structs)
│   │   └── config.go            # JAR CLI flag builder
│   ├── storage/
│   │   ├── clickhouse.go        # ClickHouse client + queries
│   │   ├── postgres.go          # PostgreSQL client + migrations
│   │   ├── s3.go                # S3 file operations
│   │   └── redis.go             # Redis cache operations
│   ├── search/
│   │   ├── bleve.go             # Bleve index management
│   │   └── kql.go               # KQL query parser
│   ├── streaming/
│   │   ├── nats.go              # NATS JetStream publisher/subscriber
│   │   └── websocket.go         # WebSocket connection manager
│   ├── ai/
│   │   ├── client.go            # Claude API client
│   │   ├── registry.go          # Skill registry
│   │   └── skills/
│   │       ├── nl_query.go      # Natural language query skill
│   │       ├── error_explainer.go
│   │       ├── root_cause.go
│   │       ├── performance.go
│   │       ├── anomaly.go
│   │       └── summarizer.go
│   ├── worker/
│   │   ├── ingestion.go         # Log ingestion pipeline
│   │   ├── analysis.go          # Analysis job processor
│   │   └── indexer.go           # Search index builder
│   └── config/
│       └── config.go            # Environment-based configuration
├── migrations/
│   ├── 001_initial.up.sql       # PostgreSQL schema
│   └── 001_initial.down.sql
├── testdata/
│   ├── arapi_sample.log         # Sample API log
│   ├── arsql_sample.log         # Sample SQL log
│   ├── arfilter_sample.log      # Sample Filter log
│   ├── aresc_sample.log         # Sample Escalation log
│   └── combined_sample.log      # Combined log
├── go.mod
├── go.sum
├── Dockerfile
└── Makefile

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx           # Root layout with Clerk provider
│   │   ├── page.tsx             # Landing/redirect
│   │   ├── (auth)/
│   │   │   ├── sign-in/
│   │   │   └── sign-up/
│   │   └── (dashboard)/
│   │       ├── layout.tsx       # Dashboard layout with sidebar
│   │       ├── page.tsx         # Dashboard overview
│   │       ├── upload/
│   │       │   └── page.tsx     # File upload page
│   │       ├── analysis/
│   │       │   └── [id]/
│   │       │       └── page.tsx # Analysis results page
│   │       ├── explorer/
│   │       │   └── page.tsx     # Log explorer page
│   │       ├── trace/
│   │       │   └── page.tsx     # Transaction tracer
│   │       └── ai/
│   │           └── page.tsx     # AI chat panel
│   ├── components/
│   │   ├── ui/                  # shadcn/ui components
│   │   ├── dashboard/
│   │   │   ├── stats-cards.tsx
│   │   │   ├── top-n-table.tsx
│   │   │   ├── time-series-chart.tsx
│   │   │   └── distribution-chart.tsx
│   │   ├── upload/
│   │   │   ├── dropzone.tsx
│   │   │   └── progress-tracker.tsx
│   │   ├── explorer/
│   │   │   ├── log-table.tsx
│   │   │   ├── search-bar.tsx
│   │   │   ├── filter-panel.tsx
│   │   │   └── detail-panel.tsx
│   │   ├── ai/
│   │   │   ├── chat-panel.tsx
│   │   │   └── skill-selector.tsx
│   │   └── trace/
│   │       └── timeline.tsx
│   ├── lib/
│   │   ├── api.ts               # API client (fetch wrapper)
│   │   ├── websocket.ts         # WebSocket client
│   │   └── utils.ts
│   └── hooks/
│       ├── use-analysis.ts
│       ├── use-search.ts
│       ├── use-stream.ts
│       └── use-ai.ts
├── package.json
├── next.config.ts
├── tailwind.config.ts
├── tsconfig.json
└── Dockerfile

docker-compose.yml               # Local development stack
Makefile                          # Top-level build targets
```

**Structure Decision**: Web application pattern with separate `backend/` (Go) and `frontend/` (Next.js) directories. The backend contains two entry points (`cmd/api/` and `cmd/worker/`) that share `internal/` packages, keeping the Simplicity Gate at 3 services while allowing the worker to scale independently.

## Complexity Tracking

> No violations. 3 services (API Server, Worker, Frontend) within Simplicity Gate.

| Decision | Justification | Simpler Alternative Rejected |
|----------|---------------|------------------------------|
| Separate Worker binary | Analysis jobs are CPU/memory intensive; isolating them prevents API latency impact | Single binary considered; rejected because JAR subprocess (20GB heap) would compete with API server memory |
| ClickHouse + PostgreSQL | ClickHouse optimized for log analytics queries; PostgreSQL for ACID metadata | Single DB considered; PostgreSQL alone cannot handle sub-2s queries over 100M log rows |
| NATS JetStream | Persistent messaging for job queue + live tail fan-out | In-process channels considered; rejected because Worker runs as separate process |
